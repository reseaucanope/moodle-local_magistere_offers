{"version":3,"sources":["../src/modal_offer.js"],"names":["define","$","templates","ajax","init","modalLock","document","ready","window","location","hash","href","indexOf","replace","url","URL","id","searchParams","get","promises","call","methodname","args","done","response","obj","JSON","parse","renderName","find","val","render","then","html","js","modal","fn","Constructor","prototype","_enforceFocus","on","addClass","history","pushState","title","pathname","search","removeClass","append","appendTo","resetPopinFields","presetFullNameAndShortname","show","css","dialog","click","fail","ex","console","log","attr","idModal","autoOpen","width","height","draggable","resizable","closeOnEscape","closeText","buttons","text","alert","restoreCourseFormSubmitted","event","preventDefault","$form","newcoursename","newcourseshortname","loadingModal","position","color","opacity","backgroundColor","animation","type","data","serialize","dataType","success","error","new_id","newid","uri","split","substr","loadingModalHtmlAfterRestore","loadingModalHtmlErrorRestore","msg","setTimeout","submit","element","first","fullname","shortname"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\r\ndefine(['jquery', 'core/templates', 'core/ajax', 'jqueryui', 'local_magistere_offers/jquery.loadingModal'], function($, templates, ajax) {\r\n\r\n    return {\r\n        init: function () {\r\n            var modalLock = false;\r\n            $(document).ready(function () {\r\n                if (window.location.hash) {\r\n                    modalLock = true;\r\n                    var href = window.location.href;\r\n                    if (href.indexOf('?') == -1) {\r\n                        href = href.replace('#', '?');\r\n                    } else {\r\n                        href = href.replace('#', '&');\r\n                    }\r\n                    var url = new URL(href),\r\n                        id = url.searchParams.get(\"offer\"),\r\n                        idModal = '#modalOffer_' + id,\r\n                        promises = ajax.call([\r\n                            {methodname: 'local_magistere_offers_get_detail_offer', args: {id: id}}\r\n                        ]);\r\n\r\n                    promises[0].done(function (response) {\r\n                        obj = JSON.parse(response);\r\n                        var renderName = 'local_magistere_offers/modal_formation_offer';\r\n\r\n                        if (obj['is_formation'] === false) {\r\n                            renderName = 'local_magistere_offers/modal_course_offer';\r\n                            $('#restore_course_form').find('input[name=\"hubcourseid\"]').val(id);\r\n                        }\r\n\r\n                        templates.render(renderName, obj)\r\n                            .then(function (html, js) {\r\n                                $('#detailModal').html(html);\r\n                                $(idModal).modal('show');\r\n                                // Correction bug popin sur firefox : empeche la modal de bootstrap de récupérer le focus\r\n                                $.fn.modal.Constructor.prototype._enforceFocus = function() {};\r\n                                $('#detailModal .modal').on('shown.bs.modal', function () {\r\n                                    $('body').addClass('modal-open');\r\n                                });\r\n                                $('#detailModal .modal').on('hidden.bs.modal', function () {\r\n                                    history.pushState(\"\", document.title, window.location.pathname + window.location.search);\r\n                                    $('body').removeClass('modal-open');\r\n                                    modalLock = false;\r\n                                });\r\n                                $('<script>').append(js).appendTo('body');\r\n\r\n                                $(\"#detailModal\").on(\"click\", \".restore.link.course\", function(e) {\r\n                                    resetPopinFields(\"#dialog_restore_course\");\r\n                                    presetFullNameAndShortname(\"#dialog_restore_course\");\r\n                                    $('#dialog_restore_course').show();\r\n                                    $('.modal-backdrop').css('z-index', 1050);\r\n                                    $('#dialog_restore_course').dialog('open');\r\n                                });\r\n\r\n                                $(\".ui-button-icon.ui-icon-closethick\").click(function(e){\r\n                                    $('.modal-backdrop').css('z-index', 1040);\r\n                                    resetPopinFields(\"#dialog_restore_course\");\r\n                                });\r\n\r\n                                $(\".ui-dialog-titlebar-close\").click(function(e){\r\n                                    $('.modal-backdrop').css('z-index', 1040);\r\n                                    resetPopinFields(\"#dialog_restore_course\");\r\n                                });\r\n                            });\r\n\r\n                    }).fail(function (ex) {\r\n                        console.log(ex);\r\n                        modalLock = false;\r\n                    });\r\n                }\r\n                \r\n            });\r\n\r\n            $('#region-main').on(\"click\", 'a[ref-bs-element=\"modal\"]', function(){\r\n                if(modalLock){\r\n                    return;\r\n                }\r\n\r\n                modalLock = true;\r\n\r\n                var id = $(this).attr('ref-modal-id'),\r\n                    idModal = '#' + $(this).attr('ref-modal'),\r\n                    promises = ajax.call([\r\n                        {methodname: 'local_magistere_offers_get_detail_offer', args: {id: id}}\r\n                    ]);\r\n\r\n                promises[0].done(function(response) {\r\n                    obj = JSON.parse(response);\r\n                    var renderName = 'local_magistere_offers/modal_formation_offer';\r\n\r\n                    if(obj['is_formation'] === false){\r\n                        renderName = 'local_magistere_offers/modal_course_offer';\r\n                        $('#restore_course_form').find('input[name=\"hubcourseid\"]').val(id);\r\n                    }\r\n\r\n                    templates.render(renderName, obj)\r\n                        .then(function(html, js) {\r\n                            // Here eventually I have my compiled template, and any javascript that it generated.\r\n                            // The templates object has append, prepend and replace functions.\r\n                            $('#detailModal').html(html);\r\n                            $(idModal).modal('show');\r\n                            // Correction bug popin sur firefox : empeche la modal de bootstrap de récupérer le focus\r\n                            $.fn.modal.Constructor.prototype._enforceFocus = function() {};\r\n\r\n                            $('#detailModal .modal').on('shown.bs.modal', function() {\r\n                                $('body').addClass('modal-open');\r\n                            });\r\n                            $('#detailModal .modal').on('hidden.bs.modal', function() {\r\n                                history.pushState(\"\", document.title, window.location.pathname + window.location.search);\r\n                                $('body').removeClass('modal-open');\r\n                            });\r\n\r\n                            $('<script>').append(js).appendTo('body');\r\n\r\n                            $(\"#detailModal\").on(\"click\", \".restore.link.course\", function(e) {\r\n                                resetPopinFields(\"#dialog_restore_course\");\r\n                                presetFullNameAndShortname(\"#dialog_restore_course\");\r\n                                $('#dialog_restore_course').show();\r\n                                $('.modal-backdrop').css('z-index', 1050);\r\n                                $('#dialog_restore_course').dialog('open');\r\n                            });\r\n\r\n                            $(\".ui-button-icon.ui-icon-closethick\").click(function(e){\r\n                                $('.modal-backdrop').css('z-index', 1040);\r\n                                resetPopinFields(\"#dialog_restore_course\");\r\n                            });\r\n\r\n                            $(\".ui-dialog-titlebar-close\").click(function(e){\r\n                                $('.modal-backdrop').css('z-index', 1040);\r\n                                resetPopinFields(\"#dialog_restore_course\");\r\n                            });\r\n                            modalLock = false;\r\n                        })\r\n                }).fail(function(ex) {\r\n                    console.log(ex);\r\n                    modalLock = false;\r\n                });\r\n            });\r\n\r\n            // Dialog restore course\r\n            $(\"#dialog_restore_course\").dialog({\r\n                autoOpen: false,\r\n                width: 600,\r\n                height: 350,\r\n                title: \"Restaurer un parcours de formation\",\r\n                draggable: \"false\",\r\n                modal: true,\r\n                resizable: false,\r\n                closeOnEscape: false,\r\n                closeText: 'Fermer',\r\n                buttons: [{\r\n                    text: \"Restaurer\",\r\n                    id: \"btRestoreCours\",\r\n                    click: function() {\r\n                        if($('#dialog_restore_course input[name=\"fullname\"]').val() == '') {\r\n                            alert(\"Le nom est obligatoire\");\r\n                        } else if($('#dialog_restore_course input[name=\"shortname\"]').val() == '') {\r\n                            alert(\"Le nom abrégé est obligatoire\");\r\n                        } else {\r\n                            restoreCourseFormSubmitted();\r\n                        }\r\n                    }\r\n                },\r\n                    {\r\n                        text: \"Annuler\",\r\n                        id: \"btAnnuler\",\r\n                        click: function() {\r\n                            resetPopinFields(\"#dialog_restore_course\");\r\n                            $(this).dialog(\"close\");\r\n                            $('.modal-backdrop').css('z-index', 1040);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n            \r\n            \r\n            $(document).on('submit', '#restore_course_form', function(event){\r\n                // Stop form from submitting normally\r\n                event.preventDefault();\r\n\r\n                // Get some values from elements on the page:\r\n                var $form = $(this),\r\n                    newcoursename = $form.find('input[name=\"fullname\"]').val(),\r\n                    newcourseshortname = $form.find('input[name=\"shortname\"]').val(),\r\n                    url = $form.attr('action');\r\n                \r\n                if(newcoursename == '' || newcourseshortname == ''){\r\n                    return;\r\n                }\r\n\r\n                $(\"body\").loadingModal({\r\n                    position: \"auto\",\r\n                    text: \"Restauration du parcours en cours\",\r\n                    color: \"#fff\",\r\n                    opacity: \"0.7\",\r\n                    backgroundColor: \"rgb(0,0,0)\",\r\n                    animation: \"circle\"\r\n                });\r\n\r\n                // Send the data using post\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: url,\r\n                    data: $(\"#restore_course_form\").serialize(),\r\n                    dataType: \"json\",\r\n                    success:function(response){\r\n                        if(response.error == false){\r\n                            var new_id = response.newid,\r\n                                search = url.search(\"/local/coursehub/restore.php\"),\r\n                                uri = url.split(url.substr(search))[0],\r\n                                restore_url = uri + \"/course/view.php?id=\" + new_id;\r\n                            $('body').loadingModal(\"text\",loadingModalHtmlAfterRestore(restore_url));\r\n                            $('body').loadingModal(\"animation\",\"doubleBounce\");\r\n                            resetPopinFields(\"#dialog_restore_course\");\r\n                            $('#dialog_restore_course').dialog(\"close\");\r\n                            $('.modal-backdrop').css('z-index', 1040);\r\n                        } else {\r\n                            $(\"body\").loadingModal(\"text\",loadingModalHtmlErrorRestore(response.msg));\r\n                        }\r\n                        $('.after-restore-links a').click(function(e){\r\n                            $('body').loadingModal(\"hide\");\r\n                            setTimeout(function(){$(\"body\").loadingModal(\"destroy\")},1000);\r\n                        });\r\n                    },\r\n                    error:function(error){\r\n                    \t$(\"body\").loadingModal(\"text\",loadingModalHtmlErrorRestore('Unknown error'));\r\n                        console.log(error);\r\n                    }\r\n                });\r\n            });\r\n\r\n\r\n            // Fonction permettant la restauration d'un parcours au travers d'une popin\r\n            function restoreCourseFormSubmitted(){\r\n                $('#restore_course_form').submit();\r\n            }\r\n\r\n            function loadingModalHtmlAfterRestore(url){\r\n                return '' +\r\n                    '<div>' +\r\n                    '   <p>La restauration du parcours a bien été effectué</p>' +\r\n                    '   <div class=\"after-restore-links\">' +\r\n                    '       <a class=\"btn restore-course-view\" href=\"'+url+'\">Accéder au parcours restauré</a>' +\r\n                    '       <a class=\"btn restore-course-close-modal\" href=\"\">Retour sur l\\'offre de parcours à déployer</a>' +\r\n                    '   </div>' +\r\n                    '</div>'\r\n            }\r\n\r\n            function loadingModalHtmlErrorRestore(error){\r\n                return '' +\r\n                    '<div>' +\r\n                    '   <p>La restauration du parcours a échouée (' + error + ')</p>' +\r\n                    '   <div class=\"after-restore-links\">' +\r\n                    '       <a class=\"btn restore-course-close-modal\" href=\"\">Retour sur l\\'offre de parcours à déployer</a>' +\r\n                    '   </div>' +\r\n                    '</div>'\r\n            }\r\n\r\n            function resetPopinFields(element){\r\n                $(element+' input[name=\"fullname\"]').val('');\r\n                $(element+' input[name=\"shortname\"]').val('');\r\n                $(element+' select[name*=\"categoryid\"]').val($(element+' select[name=\"categoryid\"] option').first().val());\r\n            }\r\n\r\n            function presetFullNameAndShortname(element){\r\n                var fullname = $('#detailModal #modalOfferTitle').text(),\r\n                    shortname = $('#detailModal .hidden .shortname').text();\r\n\r\n                $(element+' input[name=\"fullname\"]').val(fullname);\r\n                $(element+' input[name=\"shortname\"]').val(shortname);\r\n            }\r\n        }\r\n    }\r\n});\r\n"],"file":"modal_offer.min.js"}