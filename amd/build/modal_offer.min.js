define ("local_magistere_offers/modal_offer",["jquery","core/templates","core/ajax","jqueryui","local_magistere_offers/jquery.loadingModal"],function(a,b,c){return{init:function init(){var i=!1;a(document).ready(function(){if(window.location.hash){i=!0;var d=window.location.href;if(-1==d.indexOf("?")){d=d.replace("#","?")}else{d=d.replace("#","&")}var e=new URL(d),f=e.searchParams.get("offer"),j=c.call([{methodname:"local_magistere_offers_get_detail_offer",args:{id:f}}]);j[0].done(function(c){obj=JSON.parse(c);var d="local_magistere_offers/modal_formation_offer";if(!1===obj.is_formation){d="local_magistere_offers/modal_course_offer";a("#restore_course_form").find("input[name=\"hubcourseid\"]").val(f)}b.render(d,obj).then(function(b,c){a("#detailModal").html(b);a("#modalOffer_"+f).modal("show");a.fn.modal.Constructor.prototype._enforceFocus=function(){};a("#detailModal .modal").on("shown.bs.modal",function(){a("body").addClass("modal-open")});a("#detailModal .modal").on("hidden.bs.modal",function(){history.pushState("",document.title,window.location.pathname+window.location.search);a("body").removeClass("modal-open");i=!1});a("<script>").append(c).appendTo("body");a("#detailModal").on("click",".restore.link.course",function(){g("#dialog_restore_course");h("#dialog_restore_course");a("#dialog_restore_course").show();a(".modal-backdrop").css("z-index",1050);a("#dialog_restore_course").dialog("open")});a(".ui-button-icon.ui-icon-closethick").click(function(){a(".modal-backdrop").css("z-index",1040);g("#dialog_restore_course")});a(".ui-dialog-titlebar-close").click(function(){a(".modal-backdrop").css("z-index",1040);g("#dialog_restore_course")})})}).fail(function(a){console.log(a);i=!1})}});a("#region-main").on("click","a[ref-bs-element=\"modal\"]",function(){if(i){return}i=!0;var d=a(this).attr("ref-modal-id"),e="#"+a(this).attr("ref-modal"),f=c.call([{methodname:"local_magistere_offers_get_detail_offer",args:{id:d}}]);f[0].done(function(c){obj=JSON.parse(c);var f="local_magistere_offers/modal_formation_offer";if(!1===obj.is_formation){f="local_magistere_offers/modal_course_offer";a("#restore_course_form").find("input[name=\"hubcourseid\"]").val(d)}b.render(f,obj).then(function(b,c){a("#detailModal").html(b);a(e).modal("show");a.fn.modal.Constructor.prototype._enforceFocus=function(){};a("#detailModal .modal").on("shown.bs.modal",function(){a("body").addClass("modal-open")});a("#detailModal .modal").on("hidden.bs.modal",function(){history.pushState("",document.title,window.location.pathname+window.location.search);a("body").removeClass("modal-open")});a("<script>").append(c).appendTo("body");a("#detailModal").on("click",".restore.link.course",function(){g("#dialog_restore_course");h("#dialog_restore_course");a("#dialog_restore_course").show();a(".modal-backdrop").css("z-index",1050);a("#dialog_restore_course").dialog("open")});a(".ui-button-icon.ui-icon-closethick").click(function(){a(".modal-backdrop").css("z-index",1040);g("#dialog_restore_course")});a(".ui-dialog-titlebar-close").click(function(){a(".modal-backdrop").css("z-index",1040);g("#dialog_restore_course")});i=!1})}).fail(function(a){console.log(a);i=!1})});a("#dialog_restore_course").dialog({autoOpen:!1,width:600,height:350,title:"Restaurer un parcours de formation",draggable:"false",modal:!0,resizable:!1,closeOnEscape:!1,closeText:"Fermer",buttons:[{text:"Restaurer",id:"btRestoreCours",click:function click(){if(""==a("#dialog_restore_course input[name=\"fullname\"]").val()){alert("Le nom est obligatoire")}else if(""==a("#dialog_restore_course input[name=\"shortname\"]").val()){alert("Le nom abr\xE9g\xE9 est obligatoire")}else{d()}}},{text:"Annuler",id:"btAnnuler",click:function click(){g("#dialog_restore_course");a(this).dialog("close");a(".modal-backdrop").css("z-index",1040)}}]});a(document).on("submit","#restore_course_form",function(b){b.preventDefault();var c=a(this),d=c.find("input[name=\"fullname\"]").val(),h=c.find("input[name=\"shortname\"]").val(),i=c.attr("action");if(""==d||""==h){return}a("body").loadingModal({position:"auto",text:"Restauration du parcours en cours",color:"#fff",opacity:"0.7",backgroundColor:"rgb(0,0,0)",animation:"circle"});a.ajax({type:"POST",url:i,data:a("#restore_course_form").serialize(),dataType:"json",success:function success(b){if(!1==b.error){var c=b.newid,d=i.search("/local/coursehub/restore.php"),h=i.split(i.substr(d))[0];a("body").loadingModal("text",e(h+"/course/view.php?id="+c));a("body").loadingModal("animation","doubleBounce");g("#dialog_restore_course");a("#dialog_restore_course").dialog("close");a(".modal-backdrop").css("z-index",1040)}else{a("body").loadingModal("text",f(b.msg))}a(".after-restore-links a").click(function(){a("body").loadingModal("hide");setTimeout(function(){a("body").loadingModal("destroy")},1e3)})},error:function error(b){a("body").loadingModal("text",f("Unknown error"));console.log(b)}})});function d(){a("#restore_course_form").submit()}function e(a){return"<div>   <p>La restauration du parcours a bien \xE9t\xE9 effectu\xE9</p>   <div class=\"after-restore-links\">       <a class=\"btn restore-course-view\" href=\""+a+"\">Acc\xE9der au parcours restaur\xE9</a>       <a class=\"btn restore-course-close-modal\" href=\"\">Retour sur l'offre de parcours \xE0 d\xE9ployer</a>   </div></div>"}function f(a){return"<div>   <p>La restauration du parcours a \xE9chou\xE9e ("+a+")</p>   <div class=\"after-restore-links\">       <a class=\"btn restore-course-close-modal\" href=\"\">Retour sur l'offre de parcours \xE0 d\xE9ployer</a>   </div></div>"}function g(b){a(b+" input[name=\"fullname\"]").val("");a(b+" input[name=\"shortname\"]").val("");a(b+" select[name*=\"categoryid\"]").val(a(b+" select[name=\"categoryid\"] option").first().val())}function h(b){var c=a("#detailModal #modalOfferTitle").text(),d=a("#detailModal .hidden .shortname").text();a(b+" input[name=\"fullname\"]").val(c);a(b+" input[name=\"shortname\"]").val(d)}}}});
//# sourceMappingURL=modal_offer.min.js.map
